<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Twitch Alert</title>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <form id="set-channel">
    <fieldset>
      <label for="">Nome tag do canal</label>
      <input type="text" id="channel">
    </fieldset>
    <fieldset>
      <button type="submit" id="btnSetChannel">adicionar canal</button>
    </fieldset>
    <fieldset>
      <button id="reset">limpar</button>
    </fieldset>
    <fieldset>
      <label for="">Modo Dark</label>
      <div class="toggle-type">
        <div class="toggle-type-key"></div>
      </div>
    </fieldset>
  </form>

  <audio controls>
    <source src="./alert.mp3" type="audio/mp3">
  </audio>

  <main id="messages">
    <h2>Mensagens do chat Twitch </h2>

  </main>


  <script src="/socket.io/socket.io.js"></script>
  <script>
    const url_socket = `${location.protocol}//${location.host}`
    const socket = io(url_socket)
    const qs = (tag) => document.querySelector(tag)

    const setChannel = qs('#set-channel')
    const btnResetChannel = qs('#reset')
    const btnSet = qs('#btnSetChannel')
    const channel = qs('#channel')
    const sound = qs('audio')
    let myId
    const logMsg = qs('#messages')
    let alertActive = false



    btnResetChannel.disabled = true

    setChannel.addEventListener('submit', (e) => {
      e.preventDefault()
      if (channel.value == '') {
        alert('o campo de canal n√£o pode ser vazio')
        return
      }


      btnSet.disabled = true
      channel.disabled = true
      btnResetChannel.disabled = false

      socket.emit('channel-name', {
        channel: channel.value
      })

      logMsg.innerHTML = `       
          <h2>Mensagens do chat Twitch: ${channel.value} </h2>        
      `

    })

    btnResetChannel.addEventListener('click', () => {
      btnResetChannel.disabled = true
      channel.disabled = false
      btnSet.disabled = false
      channel.value = ''
      socket.emit('clear-channel', {})
      logMsg.innerHTML = `       
          <h2>Mensagens do chat Twitch </h2>        
      `
    })
  </script>
  <script>
    socket.on('connection-me', (data => {
      myId = data.id
    }))

    socket.on('new-msg-tw', (data) => {
      if (!alertActive) {
        sound.play()
        alertActive = true
        setTimeout(() => {
          alertActive = false
        }, 10000);
      }
      logMsg.innerHTML += `
        <section class='message'>
          ${data.name}: ${data.message}
        </section>
      `
    })
  </script>
  <script src="./style.js"></script>
</body>

</html>